### ä¸»æµæ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»
#### ActiveMQ
ActiveMQæ˜¯Apacheå‡ºå“ï¼Œæœ€æµè¡Œçš„ï¼Œèƒ½åŠ›å¼ºåŠ²çš„å¼€æºæ¶ˆæ¯æ€»çº¿ï¼Œå¹¶ä¸”ä»–æ˜¯ä¸€ä¸ªå®Œå…¨æ”¯æŒJMSè§„èŒƒçš„æ¶ˆæ¯ä¸­é—´ä»¶ã€‚å…¶ä¸°å¯Œçš„APIã€å¤šç§é›†ç¾¤æ„å»ºæ¨¡å¼ä½¿å¾—ä»–æˆä¸ºä¸šç•Œè€ç‰Œæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œåœ¨ä¸­å°å‹ä¼ä¸šä¸­åº”ç”¨å¹¿æ³›ï¼
MQè¡¡é‡æŒ‡æ ‡ï¼šæœåŠ¡æ€§èƒ½ã€æ•°æ®å­˜å‚¨ã€é›†ç¾¤æ¶æ„
é€æ¸åœ¨è¢«æ–°å‹æ¶ˆæ¯ä¸­é—´ä»¶æ›¿ä»£ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«å¤§çš„å¹¶å‘åœºæ™¯ï¼ŒActiveæ¨¡å¼ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å…¶æ¶æ„å¦‚ä¸‹ï¼š

![](../picture/rabbitmq/rabbitmq4.png)

#### Kafka
Kafkaæ˜¯Linkedlnå¼€æºåˆ†å¸ƒå¼å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œç›®å‰å½’å±äºApacheé¡¶çº§é¡¹ç›®ã€‚Kafkaä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäºPullæ¨¡å¼æ¥å¤„ç†æ¶ˆæ¯æ¶ˆè´¹ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œä¸€å¼€å§‹å°±æ˜¯ä¸ºå¤§æ•°æ®è®¾è®¡ï¼Œçš„ç›®çš„å°±æ˜¯ç”¨äºæ—¥å¿—æ”¶é›†å’Œä¼ è¾“ã€‚0.8ç‰ˆæœ¬å¼€å§‹æ”¯æŒå¤åˆ¶ï¼Œä¸æ”¯æŒäº‹åŠ¡ï¼Œå¯¹æ¶ˆæ¯çš„é‡å¤ã€ä¸¢å¤±ã€é”™è¯¯æ²¡æœ‰ä¸¥æ ¼è¦æ±‚ï¼ŒåŸºäºå†…å­˜ï¼Œé€‚åˆäº§ç”Ÿå¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚é›†ç¾¤æ¶æ„å¦‚ä¸‹ï¼š

![](../picture/rabbitmq/rabbitmq5.png)

####RocketMQ
RocketMQæ˜¯é˜¿é‡Œå¼€æºçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç›®å‰ä¹Ÿæ˜¯Apacheçš„é¡¶çº§é¡¹ç›®ï¼Œçº¯Javaå¼€å‘ï¼Œå…·æœ‰é«˜ååé‡ã€é«˜å¯ç”¨æ€§ã€é€‚åˆå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨çš„ç‰¹ç‚¹ã€‚RocketMQæ€è·¯èµ·æºäºKafkaï¼Œå®ƒå¯¹æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“åŠäº‹åŠ¡æ€§åšäº†ä¼˜åŒ–ï¼Œç›®å‰åœ¨é˜¿é‡Œé›†å›¢è¢«å¹¿æ³›åº”ç”¨äºäº¤æ˜“ã€å……å€¼ã€æµè®¡ç®—ã€æ¶ˆæ¯æ¨é€ã€æ—¥å¿—æµå¼å¤„ç†ã€binglogåˆ†å‘ç­‰åœºæ™¯ã€‚ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é¡ºåºæ€§ï¼Œé›†ç¾¤æ¶æ„å¤šç»´ï¼ˆ1-1,1-n,n-nï¼‰,ç»´æŠ¤å›°éš¾ï¼Œå•†ä¸šç‰ˆæ”¶è´¹ã€‚åŠæ¶æ„å¦‚ä¸‹ï¼š

![](../picture/rabbitmq/rabbitmq6.png)

### RabbitMQ
#### RabbitMQç®€ä»‹
RabbitMQæ˜¯ä¸€ä¸ªå¼€æºçš„æ¶ˆæ¯ä»£ç†å’Œé˜Ÿåˆ—æœåŠ¡å™¨ï¼Œç”¨æ¥é€šè¿‡æ™®é€šåè®®åœ¨å®Œå…¨ä¸åŒçš„åº”ç”¨ä¹‹é—´å…±äº«æ•°æ®ï¼ŒRabbitMQæ˜¯ä½¿ç”¨Erlangè¯­è¨€æ¥ç¼–å†™çš„ï¼Œå¹¶ä¸”RabbitMQæ˜¯åŸºäºAMQPåè®®çš„ã€‚
1.å¼€æºã€æ€§èƒ½ä¼˜ç§€ã€ç¨³å®šæ€§ä¿éšœã€æä¾›å¯é æ€§æŠ•é€’æ¨¡å¼ã€è¿”å›æ¨¡å¼
2.ä¸springAMQPå®Œç¾çš„æ•´åˆï¼ŒAPIä¸°å¯Œ
3.é›†ç¾¤æ¨¡å¼ä¸°å¯Œï¼Œæ”¯æŒè¡¨è¾¾å¼çš„é…ç½®ï¼ŒHAæ¨¡å¼ï¼Œé•œåƒé˜Ÿåˆ—æ¨¡å¼
4.ä¿è¯æ•°æ®ä¸ä¸¢å¤±çš„å‰æä¸‹åšåˆ°é«˜å¯é æ€§
AMQPé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼š
AMQPå®šä¹‰ï¼šæ˜¯å…·æœ‰ç°ä»£ç‰¹å¾çš„äºŒè¿›åˆ¶åè®®ã€‚æ˜¯ä¸€ä¸ªæä¾›ç»Ÿä¸€æ¶ˆæ¯æœåŠ¡çš„åº”ç”¨å±‚æ ‡å‡†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ã€‚åè®®æ¨¡å‹å¦‚ä¸‹å›¾ï¼š![](../picture/rabbitmq/rabbitmq1.png)
AMQPçš„ä¸»è¦ç‰¹å¾æ˜¯é¢å‘æ¶ˆæ¯ã€é˜Ÿåˆ—ã€è·¯ç”±ï¼ˆåŒ…æ‹¬ç‚¹å¯¹ç‚¹å’Œå‘å¸ƒ/è®¢é˜…ï¼‰ã€å¯é æ€§ã€å®‰å…¨ï¼Œæ›´å¤šç”¨åœ¨ä¼ä¸šç³»ç»Ÿå†…ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§ï¼Œç¨³å®šæ€§å’Œå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå¯¹æ€§èƒ½å’Œååé‡çš„è¦æ±‚è¿˜åœ¨å…¶æ¬¡ã€‚
AMQPæ ¸å¿ƒæ¦‚å¿µï¼š
1.==Server==ï¼šåˆç§°Brokerï¼Œæ¥å—å®¢æˆ·ç«¯çš„é“¾æ¥ï¼Œå®ç°AMQPå®ä½“æœåŠ¡
2.==Connection==ï¼šè¿æ¥ï¼Œåº”ç”¨ç¨‹åºä¸Brokerçš„ç½‘ç»œè¿æ¥
3.==Channel==ï¼šç½‘ç»œä¿¡é“ï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨Channelä¸­è¿›è¡Œï¼ŒChannelæ˜¯è¿›è¡Œæ¶ˆæ¯è¯»å†™çš„é€šé“ï¼Œå®¢æˆ·ç«¯å¯ä»¥å»ºç«‹å¤šä¸ªChannelï¼Œæ¯ä¸ªChannelä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡ã€‚
4.==Message==ï¼šæ¶ˆæ¯ï¼ŒæœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€çš„æ•°æ®ï¼Œç”±Propertieså’ŒBodyç»„æˆã€‚Propertieså¯ä»¥å¯¹æ¶ˆæ¯è¿›è¡Œä¿®é¥°ï¼Œæ¯”å¦‚æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€å»¶è¿Ÿç­‰é«˜çº§ç‰¹æ€§ï¼›Bodyåˆ™å°±æ˜¯æ¶ˆæ¯ä½“å†…å®¹ã€‚
5.==Virtual Host==ï¼šè™šæ‹Ÿåœ°å€ï¼Œç”¨äºè¿›è¡Œé€»è¾‘éš”ç¦»ï¼Œæœ€ä¸Šå±‚çš„æ¶ˆæ¯è·¯ç”±ã€‚ä¸€ä¸ªVirtual Hosté‡Œé¢å¯ä»¥æœ‰è‹¥å¹²ä¸ªExchangeæˆ–Queueï¼ŒåŒä¸€ä¸ªVirtual Hosté‡Œé¢ä¸èƒ½æœ‰ç›¸åŒåè½¦çš„Exchangeæˆ–Queue
6.==Exchange==ï¼šäº¤æ¢æœºï¼Œæ¥æ”¶æ¶ˆæ¯ï¼Œæ ¹æ®è·¯ç”±é”®è½¬å‘æ¶ˆæ¯åˆ°ç»‘å®šçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚
7.==Binding==:Exchangeå’ŒQueueè´¨æ£€çš„è™šæ‹Ÿè¿æ¥ï¼Œbindingä¸­å¯ä»¥åŒ…å«routing key
8.==Routing key==ï¼šä¸€ä¸ªè·¯ç”±è§„åˆ™ï¼Œè™šæ‹Ÿæœºå¯ç”¨ä»–æ¥ç¡®å®šå¦‚ä½•è·¯ç”±ä¸€ä¸ªç‰¹å®šæ¶ˆæ¯ã€‚
9.==Queue==ï¼šä¹Ÿç§°ä¸ºMessage Queueï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¿å­˜ä¿¡æ¯å¹¶å°†ä»–ä»¬è½¬å‘ç»™æ¶ˆè´¹è€…ã€‚
#### RabbitMQæ•´ä½“æ¶æ„
RabbitMQæ•´ä½“æ¶æ„å¦‚ä¸‹å›¾ï¼š![](../picture/rabbitmq/rabbitmq2.png)

RabbitMQæ¶ˆæ¯æµè½¬å›¾å¦‚ä¸‹å›¾ï¼š![](../picture/rabbitmq/rabbitmq3.png)

RabbitMQè´Ÿè½½å‡è¡¡é›†ç¾¤å¦‚ä¸‹å›¾ï¼š![](../picture/rabbitmq/rabbitmq7.png)
#### å®‰è£…å¯åŠ¨RabbitMQ
1.å®‰è£…ï¼š
åœ¨Macä¸‹æ‰§è¡Œ`brew install rabbitmq`ï¼Œä¼šè‡ªåŠ¨å®‰è£…rabbitmqå’Œä¾èµ–çš„erlangè¯­è¨€ã€‚
```
==> Installing rabbitmq dependency: erlang
==> Downloading https://homebrew.bintray.com/bottles/erlang-21.2.4.high_sierra.b
######################################################################## 100.0%
==> Pouring erlang-21.2.4.high_sierra.bottle.tar.gz
==> Caveats
Man pages can be found in:
  /usr/local/opt/erlang/lib/erlang/man

Access them with `erl -man`, or add this directory to MANPATH.
==> Summary
ğŸº  /usr/local/Cellar/erlang/21.2.4: 5,684 files, 272.5MB
==> Installing rabbitmq
==> Downloading https://github.com/rabbitmq/rabbitmq-server/releases/download/v3
==> Downloading from https://github-production-release-asset-2e65be.s3.amazonaws
######################################################################## 100.0%
==> /usr/bin/unzip -qq -j /usr/local/Cellar/rabbitmq/3.7.11/plugins/rabbitmq_man
==> Caveats

```
2.é…ç½®ç¯å¢ƒå˜é‡ï¼š
æ‰§è¡Œï¼š`export PATH=$PATH:/usr/local/sbin`
3.å¯åŠ¨rabbitmqï¼š
åå°å¯åŠ¨æœåŠ¡ï¼š`rabbitmq-server`
åœæ­¢æœåŠ¡ï¼š`rabbitmqctl stop`
åœ¨æµè§ˆå™¨çª—å£æ‰“å¼€Â·ip:15672(é»˜è®¤ç«¯å£)![](..picture/rabbitmq/rabbitmq8.png)
4.å¸¸ç”¨å‘½ä»¤è¡Œæ“ä½œï¼š

1.`rabbit-server`ï¼šå¯åŠ¨æœåŠ¡

2.`rabbitmqctl stop`å¯åŠ¨æœåŠ¡

3.`rabbitmqctl add_user username password`:æ·»åŠ ç”¨æˆ·

4.`rabbitmqctl list_users`:åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·

5.`rabbitmqctl delete_user username`:åˆ é™¤ç”¨æˆ·

6.`rabbitmqctl clear_permissions -p vhostpath username`:æ¸…é™¤ç”¨æˆ·æƒé™

7.`rabbitmqctl list_user_permissions username`:åˆ—å‡ºç”¨æˆ·æƒé™

8.`rabbitmqctl change_password  username newpassword`:ä¿®æ”¹å¯†ç 

9.`rabbitmqctl set_permission -p vhostpath username ".*" ".*" ".*"`:è®¾ç½®ç”¨æˆ·æƒé™

10.`rabbitmqctl add_vhost vhostpath`:åˆ›å»ºè™šæ‹Ÿä¸»æœº

11.`rabbitmqctl list_vhost`:åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº

12.`rabbitmqctl list_permission -p vhostpath`:åˆ—å‡ºè™šæ‹Ÿæœºä¸»æœºä¸Šçš„æ‰€æœ‰æƒé™

13.`rabbitmqctl delete_vhost vhostpath`:åˆ é™¤è™šæ‹Ÿä¸»æœº

14.`rabbitmqctl list_queues`:æŸ¥çœ‹æ‰€æœ‰é˜Ÿåˆ—ä¿¡æ¯

15.`rabbitmqctl -p vhostpath purge_queue blue`:æ¸…é™¤é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯

16.`rabbitmq reset`:æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼Œåœ¨åœæ­¢æœåŠ¡åæ‰èƒ½æ‰§è¡Œ

17.`rabbitmqctl join_cluster <clusternode> [---ram]`:ç»„æˆé›†ç¾¤å‘½ä»¤
  
18.`rabbitmqctl cluster_status`:æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

19.`rabbitmqctl change_cluster_node_type disc | ram`:ä¿®æ”¹é›†ç¾¤èŠ‚ç‚¹çš„å­˜å‚¨å½¢å¼

20.`rabbitmqctl forget_cluster_node [--offline]`:å¿˜è®°èŠ‚ç‚¹ï¼ˆæ‘˜é™¤èŠ‚ç‚¹ï¼‰

21.`rabbitmqctl rename_cluster_node oldnode1 newnode1 [oldnode2] [newnode2...]ï¼ˆä¿®æ”¹èŠ‚ç‚¹åç§°ï¼‰`
### rabbitmqé€šè¿‡Pythonå®ç°
#### part1 simple demo
##### send.py
ï¼[](http://www.rabbitmq.com/img/tutorials/sending.png)
```
import pika

#å»ºç«‹ä¸RabbitMQæœåŠ¡å™¨çš„è¿æ¥
connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

#åœ¨RabbitMQä¸­ï¼Œæ¶ˆæ¯æ°¸è¿œä¸èƒ½ç›´æ¥å‘é€åˆ°é˜Ÿåˆ—ï¼Œè€Œæ˜¯å…ˆé€šè¿‡äº¤æ¢æœº,æˆ‘ä»¬åœ¨è¿™ä½¿ç”¨ä¸€ç§ç”±ç©ºå­—ç¬¦ä¸²æ ‡è¯†çš„é»˜è®¤äº¤æ¢ï¼ˆå…è®¸å‡†ç¡®åœ°æŒ‡å®šæ¶ˆæ¯åº”è¯¥å»å“ªä¸ªé˜Ÿåˆ—ï¼Œéœ€è¦åœ¨`routing_key`ä¸­æŒ‡å®šé˜Ÿåˆ—åç§°ï¼‰
channel.basic_publish(exchange='',routing_key='hello',body='Hello Worldï¼')
print(" [x] Sent 'Hello World!'")
#åœ¨é€€å‡ºç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åˆ·æ–°ç½‘ç»œç¼“å†²åŒºå¹¶ä¸”æˆ‘ä»¬çš„æ¶ˆæ¯å®é™…ä¸Šå·²ä¼ é€’ç»™RabbitMQã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è½»è½»å…³é—­è¿æ¥æ¥å®ç°
connection.close()
```
##### receive.py
![](http://www.rabbitmq.com/img/tutorials/receiving.png)
```
import pika

connection = pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
channel = connection.channel()

channel.queue_declare(queue='hello')


def callback(ch, method, properties, body):
    print(" [x] Received %r" % body)


channel.basic_consume(callback,
                      queue='hello',
                      no_ack=True)

print(' [*] Waiting for messages. To exit press CTRL+C')
channel.start_consuming() # å¯åŠ¨æ— é™å¾ªç¯çš„ç›‘å¬

```
Part1ç®€å•è¯´æ˜äº†å¦‚ä½•å‘é€åŠæ¥å—æ¶ˆæ¯ã€‚æ‰§è¡Œ==receive.py==åå¯ä»¥çœ‹åˆ°ï¼š`[*] Waiting for messages. To exit press CTRL+C`ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„RabbitMQå·²ç»å¼€å§‹ç›‘å¬æ¶ˆæ¯ã€‚æ­¤æ—¶æ‰§è¡Œ==send.py==å‘é€æ¶ˆæ¯åå¯ä»¥åœ¨å±å¹•ä¸Šçœ‹åˆ°` [*] Waiting for messages. To exit press CTRL+C
[x] Received b'Hello World\xef\xbc\x81'`
åœ¨ç»ˆç«¯ä¸ŠæŸ¥çœ‹é˜Ÿåˆ—ï¼š
xiangxianzhangdeMacBook-Pro:sbin xiangxianzhang$ rabbitmqctl list_queues
Timeout: 60.0 seconds ...
Listing queues for vhost / ...
name	messages
hello	0```

```
